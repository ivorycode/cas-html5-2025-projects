<!-- _____          __                       _____                                                     -->
<!-- |_   _|        / _|                     |_   _|                                                   -->
<!--  | |   _ __  | |_  _ __   __ _  ______   | |   _ __ ___   _ __   _ __   ___  __   __  ___  _ __   -->
<!--  | |  | '_ \ |  _|| '__| / _` ||______|  | |  | '_ ` _ \ | '_ \ | '__| / _ \ \ \ / / / _ \| '__|  -->
<!-- _| |_ | | | || |  | |   | (_| |         _| |_ | | | | | || |_) || |   | (_) | \ V / |  __/| |     -->
<!-- \___/ |_| |_||_|  |_|    \__,_|         \___/ |_| |_| |_|| .__/ |_|    \___/   \_/   \___||_|     -->
<!--                                                          | |                                      -->
<!--                                                          |_|                                      -->
<!-- Copyright @Beat Weisskopf, Sandrine Ngo-Dinh, Yves Jegge                                          -->

<p-scroll-panel class="m-0 p-0">
  <form [formGroup]="defectForm" novalidate class="flex flex-col gap-1 md:gap-2 lg:gap-4">
    <!-- Title and Votes-->
    <div class="flex items-center justify-center gap-4">
      <p-iftalabel class="flex-1">
        @if (isEditable()) {
        <input pInputText id="title" formControlName="title" class="w-full" />
        <label for="title">Titel</label>
        } @else {
        <div>
          <h1 class="text-5xl font-bold"><b>{{ defectForm.controls['title'].value }}</b></h1>
        </div>
        }
      </p-iftalabel>

      <div class="flex items-center gap-1">
        <button
          type="button"
          (click)="onDefectVoteClicked($event)"
          (keyup.enter)="onDefectVoteClicked($event)"
          class="p-0 m-0 bg-transparent border-none cursor-pointer"
        >
          <i
            class="pi"
            [class.pi-thumbs-up-fill]="isVoted()"
            [class.pi-thumbs-up]="!isVoted()"
            [class.text-white]="isVoted()"
          ></i>
        </button>
        <span class="text-lg">{{ defect()?.numberOfVotes }}</span>
      </div>
    </div>

    @if (validationFailed() && defectForm.controls["title"].invalid) {
    <p-message severity="warn" variant="simple" size="small">
      Einen Titel ist notwendig.
    </p-message>
    }

    <!-- Status & Category -->
    @if (!isEditable()) {
    <div class="flex flex-wrap gap-1">
      <p-badge [value]="getDefectStateText(defect()?.state) ?? ''" severity="success" />
      <p-badge [value]="getDefectCategoryText(defect()?.category) ?? ''" severity="info" />
    </div>
    } @else {
    <!-- Category -->
    <p-iftalabel class="w-full">
      <p-select
        id="category"
        pTooltip="Wählen Sie eine Kategorie."
        formControlName="category"
        [options]="categoryOptions"
        class="w-full"
        placeholder="Kategorie wählen"
        appendTo="body"
      />
      <label for="category">Kategorie</label>
    </p-iftalabel>
    }

    <!-- Description -->
    <p-iftalabel class="w-full">
      @if(isEditable()) {
      <textarea
        pTextarea
        id="description"
        rows="4"
        [readonly]="!isEditable()"
        formControlName="description"
        class="w-full"
      ></textarea>
      <label for="description">Beschreibung</label>
      } @else { {{ defectForm.controls['description'].value }} }
    </p-iftalabel>
    @if (validationFailed() && defectForm.controls["description"].invalid) {
    <p-message severity="warn" variant="simple" size="small">
      Eine Beschreibung muss eingegeben werden.
    </p-message>
    }
  </form>

  <!-- Show Photos -->
  <ii-photos-viewer class="w-full sm:max-w-md" [images]="images()" [loading]="imagesLoading()" />

  <!-- Upload photo -->
  @if(isEditable()) {
  <ii-photo-upload class="w-full sm:max-w-md" #photoUpload (photos)="onPhotoUpload($event)" />
  }
</p-scroll-panel>
