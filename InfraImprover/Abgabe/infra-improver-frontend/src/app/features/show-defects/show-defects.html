<!-- _____          __                       _____                                                     -->
<!-- |_   _|        / _|                     |_   _|                                                   -->
<!--  | |   _ __  | |_  _ __   __ _  ______   | |   _ __ ___   _ __   _ __   ___  __   __  ___  _ __   -->
<!--  | |  | '_ \ |  _|| '__| / _` ||______|  | |  | '_ ` _ \ | '_ \ | '__| / _ \ \ \ / / / _ \| '__|  -->
<!-- _| |_ | | | || |  | |   | (_| |         _| |_ | | | | | || |_) || |   | (_) | \ V / |  __/| |     -->
<!-- \___/ |_| |_||_|  |_|    \__,_|         \___/ |_| |_| |_|| .__/ |_|    \___/   \_/   \___||_|     -->
<!--                                                          | |                                      -->
<!--                                                          |_|                                      -->
<!-- Copyright @Beat Weisskopf, Sandrine Ngo-Dinh, Yves Jegge                                          -->
<div class="h-full flex flex-col">
  <!-- Search Location -->
  <ii-search-location
    (placeChanged)="onPlaceChange($event)"
    (placeReset)="onPlaceReset()"
    class="shrink-0 my-2 gap-2"
  />
  <!-- Defect Map -->
  <ii-street-map
    class="flex-1 min-h-0"
    [defects]="defects()"
    [place]="selectedPlace()"
    [drawer]="drawerPosition()"
    [createdLocation]="createdLocation()"
    [summaryClosed]="!showDefectSummary()"
    (summaryOpen)="onSummaryOpen($event)"
    (boundariesChanged)="onBoundariesChange($event)"
  ></ii-street-map>

  <!-- Defect Drawer -->
  <ii-street-map-drawer
    [isEditable]="canEditDefect()"
    [isInEditMode]="isInEditMode()"
    [(visible)]="showDefectSummary"
    (position)="onDrawerPositionChanged($event)"
    (closeClicked)="onSummaryClose($event)"
    (editClicked)="onEditRequestedClicked($event)"
    (saveClicked)="onSaveRequestedClicked($event)"
    (deleteClicked)="onDefectDelete()"
  >
    <!-- Defect Detail -->
    <ii-show-defect-detail
      [defect]="selectedDefect()"
      [images]="selectedImages()"
      [imagesLoading]="selectedImagesLoading()"
      [isVoted]="hasVotedForSelectedDefect()"
      [isEditable]="isInEditMode()"
      [saveRequested]="saveRequested()"
      (defectToSave)="onDefectSave($event)"
      (uploadedPhotos)="onUploadedPhotos($event)"
      (votesClicked)="onDefectVoted($event)"
    />
  </ii-street-map-drawer>
</div>
